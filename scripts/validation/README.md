# Nexus ç³»ç»ŸéªŒè¯æ¡†æ¶

Nexus ç³»ç»ŸéªŒè¯æ¡†æ¶æ˜¯ä¸€ä¸ªå…¨é¢çš„è‡ªåŠ¨åŒ–æµ‹è¯•å’Œè¦†ç›–ç‡åˆ†æå·¥å…·ï¼Œç”¨äºéªŒè¯ Nexus åµŒå…¥å¼å¹³å°çš„é…ç½®ç³»ç»Ÿã€HALæ¡†æ¶ã€OSALæ¡†æ¶å’Œå¹³å°å®ç°çš„åŠŸèƒ½æ­£ç¡®æ€§ã€‚

## ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
- [å®‰è£…](#å®‰è£…)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [é…ç½®é€‰é¡¹](#é…ç½®é€‰é¡¹)
- [æŠ¥å‘Šæ ¼å¼](#æŠ¥å‘Šæ ¼å¼)
- [CIé›†æˆ](#cié›†æˆ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)

## åŠŸèƒ½ç‰¹æ€§

### æµ‹è¯•æ‰§è¡Œ
- **å•å…ƒæµ‹è¯•**: ä½¿ç”¨ Google Test æ¡†æ¶æ‰§è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
- **å±æ€§æµ‹è¯•**: ä½¿ç”¨ Hypothesis åº“æ‰§è¡ŒåŸºäºå±æ€§çš„æµ‹è¯•
- **é›†æˆæµ‹è¯•**: éªŒè¯å„å­ç³»ç»Ÿä¹‹é—´çš„äº¤äº’
- **å¹¶è¡Œæ‰§è¡Œ**: æ”¯æŒå¤šæ ¸å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ
- **å¤±è´¥å¿«é€Ÿæ¨¡å¼**: é¦–æ¬¡å¤±è´¥æ—¶ç«‹å³åœæ­¢

### è¦†ç›–ç‡åˆ†æ
- **è¡Œè¦†ç›–ç‡**: ç»Ÿè®¡ä»£ç è¡Œçš„æ‰§è¡Œè¦†ç›–ç‡
- **åˆ†æ”¯è¦†ç›–ç‡**: ç»Ÿè®¡åˆ†æ”¯æ¡ä»¶çš„è¦†ç›–ç‡
- **å‡½æ•°è¦†ç›–ç‡**: ç»Ÿè®¡å‡½æ•°è°ƒç”¨çš„è¦†ç›–ç‡
- **é˜ˆå€¼æ£€æŸ¥**: å¼ºåˆ¶æ‰§è¡Œæœ€ä½è¦†ç›–ç‡è¦æ±‚
- **æœªè¦†ç›–åŒºåŸŸæ ‡è®°**: è‡ªåŠ¨è¯†åˆ«æœªæµ‹è¯•çš„ä»£ç åŒºåŸŸ

### æŠ¥å‘Šç”Ÿæˆ
- **æ±‡æ€»æŠ¥å‘Š**: æµ‹è¯•ç»“æœç»Ÿè®¡å’Œæ¦‚è§ˆ
- **å¤±è´¥è¯¦æƒ…**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
- **æ€§èƒ½æŠ¥å‘Š**: æµ‹è¯•æ‰§è¡Œæ—¶é—´åˆ†æ
- **JUnit XML**: ç”¨äºCIå·¥å…·é›†æˆ
- **HTMLå¯è§†åŒ–**: äº¤äº’å¼ç½‘é¡µæŠ¥å‘Š

### CI/CDé›†æˆ
- **GitHub Actions**: é¢„é…ç½®çš„å·¥ä½œæµ
- **å¤šå¹³å°æ”¯æŒ**: Ubuntuã€Windowsã€macOS
- **è¦†ç›–ç‡ä¸Šä¼ **: è‡ªåŠ¨ä¸Šä¼ åˆ° Codecov
- **çŠ¶æ€æ£€æŸ¥**: è‡ªåŠ¨åŒ–çš„åˆå¹¶é—¨æ§

## ç³»ç»Ÿè¦æ±‚

### å¿…éœ€å·¥å…·
- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **CMake**: 3.15 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Ninja**: æ„å»ºç³»ç»Ÿï¼ˆæ¨èï¼‰
- **C/C++ ç¼–è¯‘å™¨**: GCC 9+, Clang 10+, æˆ– MSVC 2019+

### è¦†ç›–ç‡å·¥å…·
- **Linux/macOS**: gcov + lcov
- **Windows**: OpenCppCoverageï¼ˆå¯é€‰ï¼‰

### Python ä¾èµ–
```bash
pip install -r scripts/validation/requirements.txt
```

ä¸»è¦ä¾èµ–ï¼š
- `hypothesis`: å±æ€§æµ‹è¯•æ¡†æ¶
- `pytest`: Python æµ‹è¯•æ¡†æ¶
- `jinja2`: æŠ¥å‘Šæ¨¡æ¿å¼•æ“
- `lxml`: XML å¤„ç†
- `pyyaml`: é…ç½®æ–‡ä»¶è§£æ

## å®‰è£…

### 1. å…‹éš†ä»“åº“
```bash
git clone https://github.com/your-org/nexus.git
cd nexus
git submodule update --init --recursive
```

### 2. å®‰è£…ç³»ç»Ÿä¾èµ–

#### Ubuntu/Debian
```bash
sudo apt-get update
sudo apt-get install -y cmake ninja-build lcov python3-pip
```

#### macOS
```bash
brew install cmake ninja lcov python3
```

#### Windows
```powershell
choco install cmake ninja python3
```

### 3. å®‰è£… Python ä¾èµ–
```bash
pip install -r scripts/validation/requirements.txt
```

### 4. éªŒè¯å®‰è£…
```bash
python scripts/validation/validate.py --help
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

1. **æ„å»ºå¹¶è¿è¡Œæ‰€æœ‰æµ‹è¯•**:
```bash
python scripts/validation/validate.py
```

2. **å¯ç”¨è¦†ç›–ç‡åˆ†æ**:
```bash
python scripts/validation/validate.py --coverage
```

3. **è®¾ç½®è¦†ç›–ç‡é˜ˆå€¼**:
```bash
python scripts/validation/validate.py --coverage --threshold 0.85
```

4. **å¹¶è¡Œæ‰§è¡Œæµ‹è¯•**:
```bash
python scripts/validation/validate.py --parallel 4
```

### å…¸å‹å·¥ä½œæµ

```bash
# 1. æ¸…ç†ä¹‹å‰çš„æ„å»º
rm -rf build validation_reports

# 2. è¿è¡Œå®Œæ•´éªŒè¯ï¼ˆåŒ…æ‹¬è¦†ç›–ç‡ï¼‰
python scripts/validation/validate.py \
    --coverage \
    --threshold 0.80 \
    --parallel 8 \
    --report-dir validation_reports

# 3. æŸ¥çœ‹æŠ¥å‘Š
# HTML æŠ¥å‘Š: validation_reports/report.html
# è¦†ç›–ç‡æŠ¥å‘Š: validation_reports/coverage/index.html
# JUnit XML: validation_reports/junit.xml
```

## ä½¿ç”¨æŒ‡å—

### å‘½ä»¤è¡Œé€‰é¡¹

```
ç”¨æ³•: validate.py [é€‰é¡¹]

é€‰é¡¹:
  --build-dir DIR       æ„å»ºç›®å½•ï¼ˆé»˜è®¤: buildï¼‰
  --source-dir DIR      æºä»£ç ç›®å½•ï¼ˆé»˜è®¤: .ï¼‰
  --coverage            å¯ç”¨è¦†ç›–ç‡åˆ†æ
  --threshold FLOAT     è¦†ç›–ç‡é˜ˆå€¼ 0.0-1.0ï¼ˆé»˜è®¤: 0.80ï¼‰
  --fail-fast           é¦–æ¬¡æµ‹è¯•å¤±è´¥æ—¶åœæ­¢
  --parallel N          å¹¶è¡Œä½œä¸šæ•°ï¼ˆé»˜è®¤: CPUæ ¸å¿ƒæ•°ï¼‰
  --report-dir DIR      æŠ¥å‘Šè¾“å‡ºç›®å½•ï¼ˆé»˜è®¤: validation_reportsï¼‰
  --test-timeout SEC    æµ‹è¯•è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤: 300ç§’ï¼‰
  --verbose             è¯¦ç»†è¾“å‡ºæ¨¡å¼
  --quiet               å®‰é™æ¨¡å¼ï¼Œåªè¾“å‡ºé”™è¯¯
  --help                æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

### è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶

éªŒè¯æ¡†æ¶ä¼šè‡ªåŠ¨å‘ç°å¹¶è¿è¡Œæ‰€æœ‰æ³¨å†Œçš„æµ‹è¯•ã€‚å¦‚æœéœ€è¦è¿è¡Œç‰¹å®šæµ‹è¯•ï¼š

```bash
# ä½¿ç”¨ CTest ç›´æ¥è¿è¡Œ
cd build
ctest -R "config_.*"  # åªè¿è¡Œé…ç½®ç³»ç»Ÿæµ‹è¯•
ctest -R "hal_.*"     # åªè¿è¡Œ HAL æµ‹è¯•
ctest -R "osal_.*"    # åªè¿è¡Œ OSAL æµ‹è¯•
```

### è¦†ç›–ç‡åˆ†æ

#### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```bash
python scripts/validation/validate.py --coverage
```

è¦†ç›–ç‡æŠ¥å‘Šå°†ç”Ÿæˆåœ¨ `validation_reports/coverage/` ç›®å½•ï¼š
- `index.html`: ä¸»è¦†ç›–ç‡æŠ¥å‘Š
- `coverage.info`: lcov æ ¼å¼æ•°æ®
- `coverage.xml`: Cobertura XML æ ¼å¼

#### æ£€æŸ¥è¦†ç›–ç‡é˜ˆå€¼
```bash
python scripts/validation/check_coverage.py \
    --coverage-file build/coverage.info \
    --threshold 0.80
```

#### æŸ¥çœ‹æœªè¦†ç›–åŒºåŸŸ
è¦†ç›–ç‡æŠ¥å‘Šä¼šé«˜äº®æ˜¾ç¤ºï¼š
- ğŸ”´ çº¢è‰²ï¼šæœªæ‰§è¡Œçš„ä»£ç è¡Œ
- ğŸŸ¡ é»„è‰²ï¼šéƒ¨åˆ†è¦†ç›–çš„åˆ†æ”¯
- ğŸŸ¢ ç»¿è‰²ï¼šå®Œå…¨è¦†ç›–çš„ä»£ç 

### å±æ€§æµ‹è¯•

å±æ€§æµ‹è¯•ä½¿ç”¨ Hypothesis åº“ï¼Œæ¯ä¸ªæµ‹è¯•è‡³å°‘è¿è¡Œ 100 æ¬¡è¿­ä»£ï¼š

```python
from hypothesis import given, settings
import hypothesis.strategies as st

@settings(max_examples=100)
@given(value=st.integers())
def test_property(value):
    """
    Feature: system-validation, Property 1: æµ‹è¯•å±æ€§
    éªŒè¯éœ€æ±‚: 1.1
    """
    assert some_property_holds(value)
```

æŸ¥çœ‹å±æ€§æµ‹è¯•å¤±è´¥çš„åä¾‹ï¼š
```bash
# åä¾‹ä¼šåœ¨æµ‹è¯•è¾“å‡ºä¸­æ˜¾ç¤º
# ä¾‹å¦‚: Falsifying example: test_property(value=42)
```

## é…ç½®é€‰é¡¹

### é…ç½®æ–‡ä»¶

åˆ›å»º `validation_config.yaml` è‡ªå®šä¹‰é…ç½®ï¼š

```yaml
# æ„å»ºé…ç½®
build:
  directory: build
  generator: Ninja
  build_type: Debug
  
# æµ‹è¯•é…ç½®
testing:
  parallel_jobs: 8
  timeout: 300
  fail_fast: false
  
# è¦†ç›–ç‡é…ç½®
coverage:
  enabled: true
  threshold: 0.80
  exclude_patterns:
    - "*/tests/*"
    - "*/ext/*"
  
# æŠ¥å‘Šé…ç½®
reporting:
  output_dir: validation_reports
  formats:
    - html
    - junit
    - json
```

ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼š
```bash
python scripts/validation/validate.py --config validation_config.yaml
```

### ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®æ„å»ºç›®å½•
export NEXUS_BUILD_DIR=build_coverage

# è®¾ç½®è¦†ç›–ç‡é˜ˆå€¼
export NEXUS_COVERAGE_THRESHOLD=0.85

# è®¾ç½®å¹¶è¡Œä½œä¸šæ•°
export NEXUS_PARALLEL_JOBS=16

# è¿è¡ŒéªŒè¯
python scripts/validation/validate.py
```

## æŠ¥å‘Šæ ¼å¼

### HTML æŠ¥å‘Š

ä¸»æŠ¥å‘Š (`validation_reports/report.html`) åŒ…å«ï¼š
- æµ‹è¯•ç»“æœæ±‡æ€»è¡¨
- è¦†ç›–ç‡ç»Ÿè®¡å›¾è¡¨
- å¤±è´¥æµ‹è¯•è¯¦æƒ…
- æ€§èƒ½åˆ†æ
- äº¤äº’å¼è¿‡æ»¤å’Œæœç´¢

### JUnit XML æŠ¥å‘Š

JUnit æ ¼å¼ (`validation_reports/junit.xml`) ç”¨äº CI é›†æˆï¼š
```xml
<testsuites>
  <testsuite name="config_tests" tests="10" failures="0" time="1.23">
    <testcase name="test_config_set" time="0.12"/>
    ...
  </testsuite>
</testsuites>
```

### è¦†ç›–ç‡æŠ¥å‘Š

è¦†ç›–ç‡æŠ¥å‘Š (`validation_reports/coverage/index.html`) æä¾›ï¼š
- æ–‡ä»¶çº§è¦†ç›–ç‡ç»Ÿè®¡
- æºä»£ç è¡Œçº§è¦†ç›–ç‡å¯è§†åŒ–
- æœªè¦†ç›–ä»£ç åŒºåŸŸåˆ—è¡¨
- åˆ†æ”¯è¦†ç›–ç‡è¯¦æƒ…

## CIé›†æˆ

### GitHub Actions

é¡¹ç›®å·²åŒ…å«é¢„é…ç½®çš„ GitHub Actions å·¥ä½œæµ (`.github/workflows/validation.yml`)ï¼š

```yaml
name: System Validation
on: [push, pull_request]
jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Validation
        run: python scripts/validation/validate.py --coverage
      - name: Upload Coverage
        uses: codecov/codecov-action@v3
```

### æœ¬åœ° CI æ¨¡æ‹Ÿ

æ¨¡æ‹Ÿ CI ç¯å¢ƒè¿è¡Œï¼š
```bash
# æ¸…ç†ç¯å¢ƒ
rm -rf build validation_reports

# è¿è¡ŒéªŒè¯ï¼ˆCI æ¨¡å¼ï¼‰
python scripts/validation/validate.py \
    --coverage \
    --threshold 0.80 \
    --fail-fast \
    --report-dir validation_reports

# æ£€æŸ¥é€€å‡ºç 
echo $?  # 0 = æˆåŠŸ, é0 = å¤±è´¥
```

### å…¶ä»– CI ç³»ç»Ÿ

#### GitLab CI
```yaml
test:
  script:
    - pip install -r scripts/validation/requirements.txt
    - python scripts/validation/validate.py --coverage
  artifacts:
    reports:
      junit: validation_reports/junit.xml
      coverage_report:
        coverage_format: cobertura
        path: validation_reports/coverage.xml
```

#### Jenkins
```groovy
stage('Validation') {
    steps {
        sh 'python scripts/validation/validate.py --coverage'
        junit 'validation_reports/junit.xml'
        publishHTML([
            reportDir: 'validation_reports',
            reportFiles: 'report.html',
            reportName: 'Validation Report'
        ])
    }
}
```

## æ•…éšœæ’é™¤

è¯¦ç»†çš„æ•…éšœæ’é™¤æŒ‡å—è¯·å‚è§ [TROUBLESHOOTING.md](TROUBLESHOOTING.md)ã€‚

### å¸¸è§é—®é¢˜

#### 1. æ„å»ºå¤±è´¥
```
é”™è¯¯: CMake configuration failed
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ CMake ç‰ˆæœ¬ >= 3.15
- ç¡®ä¿æ‰€æœ‰å­æ¨¡å—å·²åˆå§‹åŒ–: `git submodule update --init --recursive`
- æ¸…ç†æ„å»ºç›®å½•: `rm -rf build`

#### 2. æµ‹è¯•è¶…æ—¶
```
é”™è¯¯: Test timeout after 300 seconds
```
**è§£å†³æ–¹æ¡ˆ**:
- å¢åŠ è¶…æ—¶æ—¶é—´: `--test-timeout 600`
- æ£€æŸ¥æ˜¯å¦æœ‰æ­»é”æˆ–æ— é™å¾ªç¯
- å‡å°‘å¹¶è¡Œä½œä¸šæ•°: `--parallel 2`

#### 3. è¦†ç›–ç‡æ•°æ®ç¼ºå¤±
```
è­¦å‘Š: No coverage data found
```
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ä½¿ç”¨ `--coverage` é€‰é¡¹
- æ£€æŸ¥ç¼–è¯‘å™¨æ”¯æŒè¦†ç›–ç‡: `gcc --version`
- éªŒè¯ lcov å·²å®‰è£…: `lcov --version`

#### 4. å±æ€§æµ‹è¯•å¤±è´¥
```
Falsifying example: test_property(value=42)
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥åä¾‹æ˜¯å¦æ­ç¤ºäº†çœŸå®çš„ bug
- å¦‚æœæ˜¯æµ‹è¯•é—®é¢˜ï¼Œè°ƒæ•´æµ‹è¯•ç­–ç•¥
- å¦‚æœæ˜¯ä»£ç é—®é¢˜ï¼Œä¿®å¤å®ç°

### è°ƒè¯•æŠ€å·§

#### å¯ç”¨è¯¦ç»†è¾“å‡º
```bash
python scripts/validation/validate.py --verbose
```

#### æŸ¥çœ‹ CMake é…ç½®
```bash
cmake -B build -DNEXUS_BUILD_TESTS=ON -DNEXUS_ENABLE_COVERAGE=ON
cmake -L build  # åˆ—å‡ºæ‰€æœ‰é…ç½®é€‰é¡¹
```

#### æ‰‹åŠ¨è¿è¡Œå•ä¸ªæµ‹è¯•
```bash
cd build
./tests/config/config_tests --gtest_filter="ConfigTest.SetGet"
```

#### æ£€æŸ¥è¦†ç›–ç‡æ•°æ®
```bash
# æŸ¥çœ‹åŸå§‹è¦†ç›–ç‡æ•°æ®
lcov --list build/coverage.info

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
genhtml build/coverage.info --output-directory coverage_html
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨ `tests/` ç›®å½•åˆ›å»ºæµ‹è¯•æ–‡ä»¶
2. åœ¨ `tests/CMakeLists.txt` æ³¨å†Œæµ‹è¯•
3. è¿è¡ŒéªŒè¯ç¡®è®¤æµ‹è¯•è¢«å‘ç°

### æ‰©å±•æŠ¥å‘Šæ ¼å¼

1. åœ¨ `report_generator.py` æ·»åŠ ç”Ÿæˆæ–¹æ³•
2. åœ¨ `templates/` æ·»åŠ æ¨¡æ¿æ–‡ä»¶
3. æ›´æ–°é…ç½®æ”¯æŒæ–°æ ¼å¼

### è´¡çŒ®æŒ‡å—

1. Fork ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/new-validator`
3. æäº¤æ›´æ”¹: `git commit -am 'Add new validator'`
4. æ¨é€åˆ†æ”¯: `git push origin feature/new-validator`
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ

- Python ä»£ç éµå¾ª PEP 8
- C/C++ ä»£ç éµå¾ªé¡¹ç›® `.clang-format`
- æ‰€æœ‰å…¬å…±å‡½æ•°éœ€è¦æ–‡æ¡£å­—ç¬¦ä¸²
- æµ‹è¯•è¦†ç›–ç‡ >= 80%

## ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•å¿«é€Ÿå‚è€ƒ](../../docs/TESTING_QUICK_REFERENCE.md)
- [è¦†ç›–ç‡è®¾ç½®æŒ‡å—](../../docs/COVERAGE_SETUP.md)
- [CI é›†æˆæ–‡æ¡£](CI_INTEGRATION.md)
- [æ¨¡æ¿æ–‡æ¡£](TEMPLATES_README.md)
- [æ•…éšœæ’é™¤æŒ‡å—](TROUBLESHOOTING.md)

## è®¸å¯è¯

Copyright (c) 2026 Nexus Team. All rights reserved.

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
- æäº¤ Issue: https://github.com/your-org/nexus/issues
- æŸ¥çœ‹æ–‡æ¡£: https://nexus.readthedocs.io
- è”ç³»å›¢é˜Ÿ: nexus-team@example.com
