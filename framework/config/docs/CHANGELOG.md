# Config Manager 变更日志

本文档记录 Config Manager 模块的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

### 计划添加
- 配置项访问权限控制
- 配置项只读属性
- 配置变更历史记录
- 配置项元数据（描述、单位等）

## [1.0.0] - 2026-01-24

### 新增
- 核心配置管理功能
  - 初始化和反初始化接口
  - 7 种数据类型支持（int32/64, uint32, float, bool, string, blob）
  - 配置项的 CRUD 操作
  - 查询和遍历接口

- 命名空间功能
  - 命名空间创建和销毁
  - 命名空间级别的配置操作
  - 命名空间隔离机制
  - 命名空间批量清除

- 默认值管理
  - 单个默认值注册
  - 批量默认值注册
  - 重置为默认值
  - 全局重置功能

- 变更通知系统
  - 特定键回调注册
  - 通配符回调支持
  - 回调管理（注册/注销）
  - 变更事件传递（旧值/新值）

- 存储后端
  - 后端抽象接口
  - RAM 后端实现
  - Flash 后端实现
  - Mock 后端（测试用）
  - 自定义后端支持

- 导入/导出功能
  - JSON 格式支持
  - 二进制格式支持
  - 命名空间级别导出
  - 导入选项（清空、跳过错误）

- 加密功能
  - AES-128/256 加密支持
  - 加密字符串和二进制数据
  - 密钥管理
  - 密钥轮换

- 线程安全
  - 全局互斥锁保护
  - 多线程环境支持

- 错误处理
  - 完整的错误码定义
  - 错误码到字符串转换
  - 最后错误码记录

### 文档
- README.md - 模块概述和快速开始
- DESIGN.md - 架构设计文档
- USER_GUIDE.md - 详细使用指南
- TEST_GUIDE.md - 测试文档
- CHANGELOG.md - 版本变更记录
- PORTING_GUIDE.md - 移植指南
- TROUBLESHOOTING.md - 故障排查指南

### 测试
- 单元测试覆盖所有核心功能
- 集成测试验证模块间交互
- 性能基准测试
- 线程安全测试
- 属性测试（Property-Based Testing）

### 性能指标
- Set 操作: >10,000 ops/sec
- Get 操作: >40,000 ops/sec
- Commit 时间: <50ms (50 个键)
- 内存占用: ~29KB (默认配置)

### 已知限制
- 最大键数量: 256
- 最大键长度: 64 字节
- 最大值大小: 1024 字节
- 最大命名空间数: 16
- 静态内存分配（不支持动态扩展）

## [0.9.0] - 2026-01-14

### 新增
- 初始原型实现
- 基本的键值存储功能
- RAM 后端支持

### 变更
- 重构数据结构设计
- 优化内存布局

## [0.5.0] - 2026-01-07

### 新增
- 项目初始化
- API 接口设计
- 架构规划

---

## 版本说明

### 主版本号（Major）
当进行不兼容的 API 变更时递增。

### 次版本号（Minor）
当以向后兼容的方式添加功能时递增。

### 修订号（Patch）
当进行向后兼容的问题修复时递增。

## 升级指南

### 从 0.9.0 升级到 1.0.0

1. **API 变更**
   - `config_init()` 现在接受配置结构体指针
   - 添加了命名空间相关 API
   - 添加了加密相关 API

2. **配置变更**
   - 默认 `max_keys` 从 32 增加到 64
   - 添加了 `auto_commit` 选项

3. **行为变更**
   - 默认不再自动提交，需要显式调用 `config_commit()`
   - 回调函数签名变更，添加了 `old_value` 参数

4. **迁移步骤**
   ```c
   /* 旧代码 */
   config_init();
   config_set_i32("key", 100);
   /* 自动保存 */
   
   /* 新代码 */
   config_init(NULL);  /* 使用默认配置 */
   config_set_i32("key", 100);
   config_commit();    /* 显式提交 */
   ```

## 贡献指南

### 提交变更日志

当提交新功能或修复时，请更新此文件：

1. 在 `[未发布]` 部分添加变更
2. 使用以下类别：
   - `新增` - 新功能
   - `变更` - 现有功能的变更
   - `弃用` - 即将移除的功能
   - `移除` - 已移除的功能
   - `修复` - 问题修复
   - `安全` - 安全相关修复

3. 描述格式：
   ```markdown
   - 简短描述变更内容
     - 可选的详细说明
     - 相关的 Issue 或 PR 编号
   ```

### 发布流程

1. 更新版本号
2. 将 `[未发布]` 部分移动到新版本号下
3. 添加发布日期
4. 创建 Git 标签
5. 生成发布说明

## 参考链接

- [项目主页](https://github.com/nexus/config)
- [问题跟踪](https://github.com/nexus/config/issues)
- [拉取请求](https://github.com/nexus/config/pulls)
- [发布页面](https://github.com/nexus/config/releases)
